<?php
require_once __DIR__ . '/../config.html';
$config = require __DIR__ . '/config_payments.html';
if (!isset($_SESSION['user_id'])) {
    header('Location: ' . BASE_URL . '/accounts/login');
    exit;
}
$user_id = $_SESSION['user_id'];

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $amount = number_format((float)$_POST['amount'], 2, '.', '');
    $order_id = 'BN' . time() . rand(1000,9999);
    $stmt = $pdo->prepare('INSERT INTO payments (user_id,gateway,amount,currency,status,txn_id) VALUES (?,?,?,?,?,?)');
    $stmt->execute([$user_id,'binance',$amount,'USDT','pending',$order_id]);
    $payment_id = $pdo->lastInsertId();

    // For production: call Binance Pay API to create order and retrieve checkoutUrl
    // Here we show a placeholder page with instructions and a fake checkout link
    $checkoutUrl = BASE_URL . '/payments/callback/binance_callback.html?demo_order=' . urlencode($order_id);
    header('Location: ' . $checkoutUrl);
    exit;
}
?>
<!doctype html><html><head><meta charset="utf-8"><title>Binance Pay</title></head><body>
<h2>Binance Pay (Demo)</h2>
<form method="post">
  <label>Amount (USDT): <input name="amount" value="1.00" required></label>
  <button type="submit">Pay with Binance Pay (Demo)</button>
</form>
</body></html>
