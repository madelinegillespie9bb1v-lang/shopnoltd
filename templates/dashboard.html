<!DOCTYPE html>
<html>
<head>
    <title>Kobo Submissions Dashboard</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f9f9f9; }
        h1 { text-align: center; color: #333; }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .btn {
            padding: 8px 16px;
            background-color: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            font-size: 14px;
        }
        .btn:hover { background-color: #0056b3; }

        table { border-collapse: collapse; width: 100%; background: white; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background-color: #007bff; color: white; }
        tr:nth-child(even) { background-color: #f2f2f2; }

        .pagination { margin: 15px 0; text-align: center; }
        .pagination a {
            padding: 5px 10px;
            margin: 2px;
            border: 1px solid #ccc;
            text-decoration: none;
            color: #333;
            border-radius: 4px;
        }
        .pagination a.current {
            background-color: #007bff;
            color: white;
            font-weight: bold;
        }

        canvas {
            display: block;
            margin: 30px auto;
            background: white;
            border: 1px solid #ccc;
            max-width: 100%;
        }
    </style>
</head>
<body>

    <div class="top-bar">
        <a href="/" class="btn">‚Üê Back to Home</a>
        <strong>Kobo Submissions Dashboard</strong>
    </div>

    {% if data %}
        <table>
            <thead>
                <tr>
                    <th>House No</th>
                    <th>Road No</th>
                    <th>Upazila</th>
                    <th>Ward</th>
                    <th>Area</th>
                    <th>Cluster</th>
                    <th>Interviewer</th>
                    <th>Start Time</th>
                    <th>End Time</th>
                    <th>Total Members</th>
                </tr>
            </thead>
            <tbody>
                {% for row in data %}
                <tr>
                    <td>{{ row.house_no }}</td>
                    <td>{{ row.road_no }}</td>
                    <td>{{ row.upazila }}</td>
                    <td>{{ row.ward }}</td>
                    <td>{{ row.area }}</td>
                    <td>{{ row.cluster }}</td>
                    <td>{{ row.interviewer_name }}</td>
                    <td>{{ row.start_time }}</td>
                    <td>{{ row.end_time }}</td>
                    <td>{{ row.total_members }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Pagination -->
        <div class="pagination">
            {% if page > 1 %}
                <a href="/dashboard?page={{ page - 1 }}">Previous</a>
            {% endif %}

            {% for p in range(1, total_pages + 1) %}
                <a href="/dashboard?page={{ p }}" class="{{ 'current' if p == page else '' }}">
                    {{ p }}
                </a>
            {% endfor %}

            {% if page < total_pages %}
                <a href="/dashboard?page={{ page + 1 }}">Next</a>
            {% endif %}
        </div>

        <!-- Chart -->
        <canvas id="chart" width="900" height="400"></canvas>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script>
            const ctx = document.getElementById('chart').getContext('2d');
            const labels = {{ data | map(attribute='_id') | list | safe }};
            const members = {{ data | map(attribute='total_members') | list | safe }};

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Total Members',
                        data: members,
                        backgroundColor: 'rgba(75, 192, 192, 0.7)'
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        </script>

    {% else %}
        <h2 style="text-align:center;">No submissions yet.</h2>
    {% endif %}

</body>
</html>
