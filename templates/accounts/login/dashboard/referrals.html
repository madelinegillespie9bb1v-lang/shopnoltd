<?php
session_start();
require_once __DIR__ . '/../../config.html';
// config.html must define $pdo and BASE_URL
?>

<?php
if (!isset($_SESSION['user'])) { header('Location: ../../accounts/login/index.html'); exit; }
$user = $_SESSION['user'];
// show referral link and list
$ref_link = (defined('BASE_URL') ? BASE_URL : '') . '/accounts/register/index.html?ref=' . urlencode($user['username']);
$stmt = $pdo->prepare("SELECT r.*, u.username as referred_username FROM referrals r LEFT JOIN users u ON u.id=r.referred_id WHERE r.user_id=:uid");
$stmt->execute([':uid'=>$user['id']]);
$refs = $stmt->fetchAll(PDO::FETCH_ASSOC);
?>
<!doctype html><html><head><meta charset="utf-8"><title>Referrals</title></head><body>
<h2>Your Referrals</h2>
<p>Share this link: <input style="width:400px" value="<?php echo htmlspecialchars($ref_link); ?>"></p>
<table border="1" cellpadding="6"><tr><th>ID</th><th>Referred User</th><th>Commission</th><th>Date</th></tr>
<?php foreach($refs as $r): ?>
<tr><td><?php echo $r['id'];?></td><td><?php echo htmlspecialchars($r['referred_username']);?></td><td>$<?php echo number_format($r['commission'],5);?></td><td><?php echo $r['created_at'];?></td></tr>
<?php endforeach; ?>
</table>
<p><a href="dashboard.html">Back</a></p>
</body></html>
